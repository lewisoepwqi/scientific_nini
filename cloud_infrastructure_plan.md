# 科研数据分析Web工具 - 云基础设施配置方案

## 一、应用需求分析

### 1.1 技术栈资源需求

| 组件 | 资源需求 | 说明 |
|------|----------|------|
| FastAPI后端 | CPU: 中等, 内存: 中高 | 处理API请求，数据分析计算 |
| React前端 | CPU: 低, 带宽: 低 | 静态资源，CDN可加速 |
| PostgreSQL | CPU: 中, 内存: 中, 存储: SSD | 关系型数据存储 |
| Redis | 内存: 低 | 缓存和消息队列 |
| Celery Worker | CPU: 高, 内存: 高 | 异步任务处理 |
| 数据分析库 | 内存: 高 | pandas, scanpy, seurat等 |
| AI功能(未来) | GPU: 可选 | 本地LLM需要GPU |

### 1.2 数据特点分析

| 数据类型 | 大小 | 处理需求 |
|----------|------|----------|
| Excel文件 | 10MB-100MB | 普通处理 |
| 分析结果 | 1MB-50MB | 存储和展示 |
| 单细胞测序数据 | 1GB-10GB+ | 大内存处理 |
| 历史记录 | 持续增长 | 数据库存储 |

---

## 二、云服务器配置推荐

### 2.1 阶段一：初期配置（1-5用户）

**推荐配置方案A（经济型）**

| 配置项 | 规格 | 说明 |
|--------|------|------|
| CPU | 4核 | 足够处理并发请求和数据分析 |
| 内存 | 8GB | 基础数据分析需求 |
| 系统盘 | 50GB SSD | 操作系统和基础软件 |
| 数据盘 | 100GB SSD | 应用数据、数据库、文件存储 |
| 带宽 | 5Mbps | 初期用户量少，足够使用 |
| 操作系统 | Ubuntu 22.04 LTS | 稳定、社区支持好 |

**推荐配置方案B（舒适型）- 推荐**

| 配置项 | 规格 | 说明 |
|--------|------|------|
| CPU | 4核 | 处理数据分析任务 |
| 内存 | 16GB | 处理较大的数据集，预留扩展空间 |
| 系统盘 | 50GB SSD | 操作系统 |
| 数据盘 | 200GB SSD | 充足的存储空间 |
| 带宽 | 10Mbps | 更好的用户体验 |
| 操作系统 | Ubuntu 22.04 LTS | 稳定可靠 |

### 2.2 阶段二：扩展配置（10-20用户）

| 配置项 | 规格 | 说明 |
|--------|------|------|
| CPU | 8核 | 更多并发处理 |
| 内存 | 32GB | 支持多用户同时分析 |
| 系统盘 | 50GB SSD | 操作系统 |
| 数据盘 | 500GB SSD | 更多数据存储 |
| 带宽 | 20Mbps | 更多用户访问 |
| 架构 | 应用+数据库分离 | 提高性能和可靠性 |

### 2.3 阶段三：AI功能配置（本地LLM）

如果需要部署本地LLM（如Llama 2/3、ChatGLM等）：

| 配置项 | 规格 | 说明 |
|--------|------|------|
| GPU | NVIDIA T4 / A10 | AI推理加速 |
| CPU | 8核+ | 配合GPU处理 |
| 内存 | 32GB+ | 模型加载需要大内存 |
| 存储 | 500GB+ SSD | 模型文件较大（7B模型约13GB） |

---

## 三、云服务商对比与推荐

### 3.1 国内主流云服务商对比

| 服务商 | 阶段一费用(月) | 阶段二费用(月) | 优势 | 劣势 |
|--------|---------------|---------------|------|------|
| **阿里云** | 200-400 | 600-1200 | 生态完善，文档丰富，稳定性高 | 价格略高 |
| **腾讯云** | 180-350 | 500-1000 | 性价比高，学生优惠多 | 部分服务生态不如阿里云 |
| **华为云** | 200-380 | 550-1100 | 企业级服务，安全合规 | 社区资源相对较少 |
| **AWS中国** | 250-450 | 700-1300 | 国际服务，功能最全 | 国内访问速度一般 |

### 3.2 详细价格对比（以4核16G为例）

**阿里云**
- ECS共享型s6 4核16G：约350/月
- ECS计算型c7 4核16G：约450/月
- 云盘：0.7/GB/月（200GB约140/月）
- 带宽：23/Mbps/月（10Mbps约230/月）
- **合计：约600-700/月**

**腾讯云**
- 标准型S5 4核16G：约320/月
- 标准型SA3 4核16G：约380/月
- 云硬盘：0.63/GB/月（200GB约126/月）
- 带宽：20/Mbps/月（10Mbps约200/月）
- **合计：约550-650/月**

**华为云**
- 通用计算型s6 4核16G：约340/月
- 通用计算增强型c7 4核16G：约420/月
- 云硬盘：0.65/GB/月（200GB约130/月）
- 带宽：22/Mbps/月（10Mbps约220/月）
- **合计：约580-720/月**

### 3.3 最终推荐

**首选推荐：腾讯云**

理由：
1. **性价比高**：相同配置下价格比阿里云低约10-15%
2. **学生优惠**：有学生认证可享受更低价格
3. **服务稳定**：国内访问速度快，服务稳定
4. **生态完善**：提供完整的数据库、存储、AI等服务

**备选方案：阿里云**
- 如果更看重生态和文档丰富度，选择阿里云
- 阿里云市场有更多现成的解决方案

---

## 四、扩展性规划

### 4.1 架构演进路线

```
阶段一（1-5用户）：单体部署
+-------------------------------------+
|  单台云服务器                        |
|  +-- FastAPI应用                    |
|  +-- PostgreSQL                     |
|  +-- Redis                          |
|  +-- Celery Worker                  |
+-------------------------------------+

阶段二（10-20用户）：应用与数据库分离
+-----------------+    +-----------------+
|  应用服务器      |    |  数据库服务器    |
|  +-- FastAPI    |<-->|  +-- PostgreSQL |
|  +-- Celery     |    |  +-- Redis      |
|  +-- Nginx      |    +-----------------+
+-----------------+

阶段三（AI功能）：引入GPU服务器
+-----------------+    +-----------------+    +-----------------+
|  Web应用服务器   |    |  数据库服务器    |    |  AI推理服务器   |
|  +-- FastAPI    |<-->|  +-- PostgreSQL |    |  +-- LLM服务   |
|  +-- Celery     |    |  +-- Redis      |    |  +-- GPU加速   |
+-----------------+    +-----------------+    +-----------------+
```

### 4.2 升级触发条件

| 指标 | 阶段一 | 阶段二 | 阶段三 |
|------|--------|--------|--------|
| 用户数 | 1-5人 | 6-15人 | 15人+ |
| 内存使用率 | <70% | 70-85% | >85% |
| CPU使用率 | <60% | 60-80% | >80% |
| 磁盘使用率 | <70% | 70-85% | >85% |
| 响应时间 | <500ms | 500ms-1s | >1s |

### 4.3 AI功能支持方案

**方案A：调用OpenAI API（推荐初期）**
- 无需GPU服务器
- 按使用量付费
- 快速集成
- 成本：0.1-0.5/千tokens

**方案B：本地部署LLM（数据敏感场景）**
- 需要GPU服务器
- 一次性投入高
- 数据隐私性好
- 推荐模型：ChatGLM3-6B、Llama 2-7B
- 额外成本：GPU服务器约1500-3000/月

---

## 五、其他基础设施建议

### 5.1 对象存储（OSS/COS/OBS）

**用途**：
- 存储用户上传的Excel文件
- 存储生成的图表和分析结果
- 数据备份

**推荐配置**：
- 标准存储：100GB起步
- 费用：约0.12/GB/月（100GB约12/月）

**服务商选择**：
- 阿里云OSS：0.12/GB/月
- 腾讯云COS：0.10/GB/月
- 华为云OBS：0.10/GB/月

### 5.2 CDN（内容分发网络）

**初期不需要**，当以下条件满足时考虑：
- 用户分布在全国各地
- 前端资源较大（>10MB）
- 需要提升访问速度

**费用**：约0.24/GB（按流量计费）

### 5.3 数据库服务选择

**方案A：自建数据库（推荐初期）**
- 在同一台服务器上部署PostgreSQL和Redis
- 成本低，管理简单
- 适合数据量<100GB的场景

**方案B：云数据库服务**
- 阿里云RDS PostgreSQL
- 腾讯云TencentDB for PostgreSQL
- 优点：自动备份、监控、高可用
- 费用：约200-500/月（根据配置）

### 5.4 备份策略

| 备份类型 | 频率 | 存储位置 | 保留时间 |
|----------|------|----------|----------|
| 数据库全量备份 | 每日 | 对象存储 | 30天 |
| 文件备份 | 实时同步 | 对象存储 | 90天 |
| 系统快照 | 每周 | 云盘快照 | 4周 |

---

## 六、成本汇总

### 6.1 阶段一（初期）月度成本

| 项目 | 配置 | 费用（腾讯云） |
|------|------|---------------|
| 云服务器 | 4核16G + 200GB SSD + 10Mbps | 600-700 |
| 对象存储 | 100GB | 10 |
| 域名+SSL | 基础版 | 50 |
| **合计** | | **660-760/月** |

### 6.2 阶段二（扩展）月度成本

| 项目 | 配置 | 费用（腾讯云） |
|------|------|---------------|
| 应用服务器 | 4核16G + 200GB SSD | 450 |
| 数据库服务器 | 4核8G + 500GB SSD | 400 |
| 对象存储 | 500GB | 50 |
| 带宽 | 20Mbps | 400 |
| CDN | 按流量 | 50 |
| **合计** | | **1350/月** |

### 6.3 阶段三（AI功能）月度成本

| 项目 | 配置 | 费用 |
|------|------|------|
| Web服务器 | 4核16G | 450 |
| 数据库服务器 | 4核8G | 400 |
| GPU服务器 | 8核32G + T4 | 2000 |
| 对象存储 | 1TB | 100 |
| OpenAI API | 按使用量 | 100-500 |
| **合计** | | **3050-3950/月** |

### 6.4 省钱技巧

1. **包年包月**：比按量付费节省30-50%
2. **学生优惠**：认证后可享受1-2折
3. **新用户优惠**：首年通常有大幅折扣
4. **抢占式实例**：非关键任务可使用，节省70%
5. **选择合适地域**：非一线城市机房价格更低

---

## 七、部署架构建议

### 7.1 Docker Compose部署（推荐初期）

```yaml
# docker-compose.yml 核心服务配置
version: '3.8'
services:
  web:
    image: research-app:latest
    ports:
      - "80:8000"
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/research
      - REDIS_URL=redis://redis:6379
  
  db:
    image: postgres:15
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  redis:
    image: redis:7-alpine
  
  celery:
    image: research-app:latest
    command: celery -A tasks worker --loglevel=info
```

### 7.2 监控告警配置

| 监控项 | 告警阈值 | 通知方式 |
|--------|----------|----------|
| CPU使用率 | >80% | 邮件+短信 |
| 内存使用率 | >85% | 邮件+短信 |
| 磁盘使用率 | >85% | 邮件 |
| 服务可用性 | 不可用 | 邮件+短信 |

---

## 八、总结与建议

### 8.1 推荐配置清单

**最优选择（阶段一）**
- **云服务商**：腾讯云
- **服务器配置**：4核16G + 200GB SSD + 10Mbps
- **操作系统**：Ubuntu 22.04 LTS
- **预计月费用**：660-760
- **部署方式**：Docker Compose单机部署

### 8.2 实施建议

1. **先小后大**：从阶段一开始，根据实际使用情况逐步升级
2. **监控先行**：部署后立即配置监控，了解资源使用
3. **数据备份**：从第一天开始做好备份策略
4. **文档记录**：记录所有配置和变更，便于后续维护

### 8.3 风险提示

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 单点故障 | 服务中断 | 定期备份，准备快速恢复方案 |
| 数据丢失 | 不可恢复 | 多重备份，异地存储 |
| 性能瓶颈 | 用户体验差 | 监控告警，及时扩容 |
| 费用超支 | 预算失控 | 设置费用告警，使用包年包月 |
