# Nini 后续开发待办清单

## 使用说明

- 文档用途：将当前架构优化后的剩余工作收敛为可执行 backlog。
- 优先级定义：
  - `P1`：建议优先推进，直接影响架构闭环或核心体验。
  - `P2`：重要但不阻塞主链路，可在 P1 完成后推进。
  - `P3`：持续优化项，适合穿插处理。

---

## P1：架构闭环

### 1. 补齐 `ResearchProfile` API 与前端闭环

- 状态：后端已完成，待 API 与前端
- 当前完成：
  - ✅ `memory/research_profile.py`：管理器与 prompt 生成
  - ✅ `agent/runner.py`：活动记录集成
  - ✅ `agent/session.py`：`research_profile_id` 持久化
- 待完成：
  - ⏳ API 端点：`GET/PUT /api/research-profile`
  - ⏳ 前端配置面板
- 验收标准：
  - 支持读取和更新默认研究画像
  - Session 能绑定 `research_profile_id`
  - Runner 能注入研究画像提示
  - 前端可展示和修改研究偏好

### 2. 验证和完善第二个可执行 Capability

- 状态：`correlation_analysis` 已实现，待验证 API 流程
- 当前完成：
  - ✅ `correlation_analysis.py`：完整实现（580 行）
  - ✅ `defaults.py`：已标记 `is_executable=True`
  - ✅ `test_correlation_analysis_capability.py`：测试已存在
- 待完成：
  - ⏳ 验证 API 直接执行流程
  - ⏳ 前端正确展示执行状态
- 后续可继续：
  - `data_exploration` 可执行实现

### 3. 深化前端 Intent 交互体验

- 状态：Intent v2 已实现，待前端深化
- 当前完成：
  - ✅ 规则版 v2：同义词扩展 + 元数据加权 + 澄清策略
  - ✅ `_SYNONYM_MAP` 覆盖 8 大科研意图
  - ✅ `IntentSummaryCard.tsx`：顶部摘要展示
- 待完成：
  - ⏳ Intent 结果接入对话时间线
  - ⏳ 展示系统理解和澄清过程
  - ⏳ 展示激活技能和推荐路径
- 后续可选：
  - 评估 embedding / 检索增强（边际收益递减，暂缓）

---

## P2：体验与科研专项深化

### 4. 前端 Intent 交互深化

- 状态：未开始
- 目标：
  - 从顶部摘要卡扩展到对话级反馈
- 待办：
  - 在时间线中展示系统理解和澄清过程
  - 展示激活技能和推荐路径
  - 对工具调用前的推荐给出更直观提示

### 5. 科研专项方法推荐增强

- 状态：未开始
- 目标：
  - 提升方法选择解释的统计严谨性
- 待办：
  - 增强前提检验和方法回退策略
  - 增强多重比较、效应量、置信区间解释模板
  - 加强局限性与风险提示

### 6. 发表级输出模板化

- 状态：未开始
- 目标：
  - 提升研究报告与图表输出的一致性
- 待办：
  - 统一报告结构模板
  - 引入结果摘要、方法说明、局限性标准段落
  - 统一 journal style 与导出策略

### 7. MCP Gateway 与新架构收口

- 状态：未开始
- 目标：
  - 让外部生态能力更自然地对齐 Intent / Capability / Skill Runtime
- 待办：
  - 清理对内部结构的直接访问
  - 用公开注册表接口替代私有字段依赖

---

## P3：工程质量与性能优化

### 8. 前端大包优化

- 状态：未开始
- 背景：
  - `npm run build` 仍提示 `plotly` chunk 偏大
- 待办：
  - 动态加载图表模块
  - 分析是否能拆分导出与预览依赖

### 9. 可观测性增强

- 状态：未开始
- 待办：
  - 记录 Intent 分析耗时
  - 记录 Capability / Skill 执行耗时
  - 聚合工具失败原因

### 10. 稳定性与恢复能力

- 状态：未开始
- 待办：
  - WebSocket 断线恢复
  - 工具调用失败重试策略
  - 长任务状态恢复与提示

---

## 推荐执行顺序（已调整）

基于代码实际进展调整：

1. **补齐 `ResearchProfile` API 与前端** - 四层记忆闭环
2. **验证 `correlation_analysis` Capability** - 确认多能力支持
3. **深化前端 Intent 交互体验** - 从摘要卡到时间线
4. **发表级输出模板化** - 统一报告结构
5. **可观测性增强** - 耗时日志与错误聚合
6. **MCP Gateway 对齐** - 外部生态规范化
7. **前端大包优化** - 动态加载图表模块

调整原因：后端实现超前于文档，优先补齐 API 闭环和前端体验。
