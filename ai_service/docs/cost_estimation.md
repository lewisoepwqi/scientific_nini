# AI服务成本估算

## OpenAI API定价（2024年）

| 模型 | 输入价格 (per 1K tokens) | 输出价格 (per 1K tokens) |
|------|------------------------|------------------------|
| GPT-4 | $0.03 | $0.06 |
| GPT-4 Turbo | $0.01 | $0.03 |
| GPT-3.5 Turbo | $0.0015 | $0.002 |

## 使用场景成本估算

### 场景1：图表推荐

**Token消耗估算：**
- System Prompt: ~500 tokens
- User Prompt (含数据描述): ~1,500 tokens
- Response: ~800 tokens
- 总计: ~2,800 tokens

**单次调用成本：**
| 模型 | 成本 |
|------|------|
| GPT-4 | $0.093 |
| GPT-4 Turbo | $0.039 |
| GPT-3.5 Turbo | $0.0058 |

**月度估算（100次/月）：**
| 模型 | 月度成本 |
|------|---------|
| GPT-4 | $9.30 |
| GPT-4 Turbo | $3.90 |
| GPT-3.5 Turbo | $0.58 |

### 场景2：数据分析

**Token消耗估算：**
- System Prompt: ~400 tokens
- User Prompt (含统计数据): ~2,000 tokens
- Response: ~1,500 tokens
- 总计: ~3,900 tokens

**单次调用成本：**
| 模型 | 成本 |
|------|------|
| GPT-4 | $0.15 |
| GPT-4 Turbo | $0.065 |
| GPT-3.5 Turbo | $0.0089 |

**月度估算（50次/月）：**
| 模型 | 月度成本 |
|------|---------|
| GPT-4 | $7.50 |
| GPT-4 Turbo | $3.25 |
| GPT-3.5 Turbo | $0.45 |

### 场景3：实验设计

**Token消耗估算：**
- System Prompt: ~600 tokens
- User Prompt: ~1,200 tokens
- Response: ~2,000 tokens
- 总计: ~3,800 tokens

**单次调用成本：**
| 模型 | 成本 |
|------|------|
| GPT-4 | $0.132 |
| GPT-4 Turbo | $0.072 |
| GPT-3.5 Turbo | $0.0058 |

**月度估算（20次/月）：**
| 模型 | 月度成本 |
|------|---------|
| GPT-4 | $2.64 |
| GPT-4 Turbo | $1.44 |
| GPT-3.5 Turbo | $0.12 |

### 场景4：多组学分析

**Token消耗估算：**
- System Prompt: ~800 tokens
- User Prompt: ~2,500 tokens
- Response: ~2,500 tokens
- 总计: ~5,800 tokens

**单次调用成本：**
| 模型 | 成本 |
|------|------|
| GPT-4 | $0.174 |
| GPT-4 Turbo | $0.133 |
| GPT-3.5 Turbo | $0.0087 |

**月度估算（30次/月）：**
| 模型 | 月度成本 |
|------|---------|
| GPT-4 | $5.22 |
| GPT-4 Turbo | $3.99 |
| GPT-3.5 Turbo | $0.26 |

## 综合成本估算

### 轻度使用（月调用200次）

| 功能 | 次数 | GPT-4 | GPT-4 Turbo | GPT-3.5 Turbo |
|------|------|-------|-------------|---------------|
| 图表推荐 | 100 | $9.30 | $3.90 | $0.58 |
| 数据分析 | 50 | $7.50 | $3.25 | $0.45 |
| 实验设计 | 20 | $2.64 | $1.44 | $0.12 |
| 多组学分析 | 30 | $5.22 | $3.99 | $0.26 |
| **总计** | 200 | **$24.66** | **$12.58** | **$1.41** |

### 中度使用（月调用500次）

| 功能 | 次数 | GPT-4 | GPT-4 Turbo | GPT-3.5 Turbo |
|------|------|-------|-------------|---------------|
| 图表推荐 | 250 | $23.25 | $9.75 | $1.45 |
| 数据分析 | 125 | $18.75 | $8.13 | $1.11 |
| 实验设计 | 50 | $6.60 | $3.60 | $0.29 |
| 多组学分析 | 75 | $13.05 | $9.98 | $0.65 |
| **总计** | 500 | **$61.65** | **$31.46** | **$3.50** |

### 重度使用（月调用1000次）

| 功能 | 次数 | GPT-4 | GPT-4 Turbo | GPT-3.5 Turbo |
|------|------|-------|-------------|---------------|
| 图表推荐 | 500 | $46.50 | $19.50 | $2.90 |
| 数据分析 | 250 | $37.50 | $16.25 | $2.23 |
| 实验设计 | 100 | $13.20 | $7.20 | $0.58 |
| 多组学分析 | 150 | $26.10 | $19.95 | $1.31 |
| **总计** | 1000 | **$123.30** | **$62.90** | **$7.02** |

## 成本优化建议

### 1. 模型选择策略

```python
# 根据任务复杂度选择模型
MODEL_SELECTION_STRATEGY = {
    "chart_recommendation": "gpt-3.5-turbo",  # 简单任务用轻量模型
    "data_analysis": "gpt-4-turbo",            # 中等复杂度
    "experiment_design": "gpt-4-turbo",        # 需要准确性
    "omics_analysis": "gpt-4",                  # 复杂任务用最强模型
}
```

### 2. Prompt优化

- **精简System Prompt**：移除不必要的说明
- **数据采样**：只发送必要的数据样本
- **结果缓存**：相同请求直接返回缓存结果

**预期节省：20-30%**

### 3. 流式响应

使用流式响应可以减少用户等待时间，但不会降低成本。

### 4. 批量处理

将多个小请求合并为一个大请求：

```python
# 不推荐：多次小请求
cost = 5 * $0.093 = $0.465

# 推荐：一次大请求
cost = $0.15  # 节省68%
```

### 5. 本地模型部署（预留）

对于高频、标准化的任务，考虑部署本地模型：

| 方案 | 初期成本 | 单次成本 | 适用场景 |
|------|---------|---------|---------|
| GPT-4 API | 低 | $0.15 | 低频、复杂任务 |
| GPT-3.5 API | 低 | $0.009 | 中频、标准任务 |
| 本地LLaMA | 高 | ~$0.001 | 高频、标准任务 |

### 6. 智能降级

```python
async def smart_analysis(task_complexity, user_tier):
    if user_tier == "premium":
        model = "gpt-4"
    elif task_complexity == "high":
        model = "gpt-4-turbo"
    else:
        model = "gpt-3.5-turbo"
    
    return await analyze_with_model(model)
```

## 成本监控

系统内置成本追踪功能：

```python
# 获取成本统计
summary = ai_service.get_cost_summary()
print(summary)
# {
#     "total_cost_usd": 12.58,
#     "total_calls": 200,
#     "average_cost_per_call": 0.063,
#     "recent_calls": [...]
# }
```

## 预算设置建议

| 使用级别 | 建议月度预算 | 推荐模型 |
|---------|-------------|---------|
| 个人/测试 | $5-10 | GPT-3.5 Turbo |
| 小团队 | $20-50 | GPT-4 Turbo |
| 中等团队 | $50-100 | GPT-4 Turbo + GPT-4 |
| 大型团队 | $100-200 | 混合策略 |

## 注意事项

1. **定价变动**：OpenAI API定价可能调整，请定期查看最新价格
2. **Token计数**：实际token数可能与估算有差异，建议预留20%缓冲
3. **汇率影响**：以美元计价，需考虑汇率波动
4. **免费额度**：新用户有$5免费额度，可用于测试
